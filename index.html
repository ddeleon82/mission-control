<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mission Control | Freedom & Coffee</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" async></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');

    *{margin:0;padding:0;box-sizing:border-box}

    :root{
      --bg-primary:#09090b;
      --bg-secondary:#111114;
      --bg-card:#16161a;
      --bg-card-hover:#1c1c22;
      --bg-elevated:#1e1e24;
      --border:rgba(255,255,255,0.06);
      --border-hover:rgba(255,255,255,0.12);
      --text-primary:#fafafa;
      --text-secondary:#a1a1aa;
      --text-muted:#52525b;
      --accent-green:#34d399;
      --accent-green-bg:rgba(52,211,153,0.08);
      --accent-yellow:#fbbf24;
      --accent-yellow-bg:rgba(251,191,36,0.08);
      --accent-blue:#60a5fa;
      --accent-blue-bg:rgba(96,165,250,0.08);
      --accent-purple:#a78bfa;
      --accent-purple-bg:rgba(167,139,250,0.08);
      --accent-red:#f87171;
      --accent-red-bg:rgba(248,113,113,0.08);
      --accent-orange:#fb923c;
      --accent-orange-bg:rgba(251,146,60,0.08);
      --accent-coffee:#c4956a;
      --accent-coffee-bg:rgba(196,149,106,0.08);
      --radius:12px;
      --radius-sm:8px;
      --radius-xs:6px;
    }

    body{
      font-family:'Inter',system-ui,-apple-system,sans-serif;
      background:var(--bg-primary);
      min-height:100vh;
      color:var(--text-primary);
      -webkit-font-smoothing:antialiased;
    }

    /* ‚ïê‚ïê‚ïê Password Gate ‚ïê‚ïê‚ïê */
    .password-gate{position:fixed;inset:0;background:var(--bg-primary);display:flex;align-items:center;justify-content:center;z-index:1000}
    .password-gate.hidden{display:none}
    .password-form{text-align:center;padding:40px}
    .password-form .logo{font-size:48px;margin-bottom:16px}
    .password-form h1{font-size:20px;font-weight:600;margin-bottom:4px;letter-spacing:-0.3px}
    .password-form p{color:var(--text-muted);font-size:13px;margin-bottom:28px}
    .password-form input{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-sm);padding:10px 16px;font-size:14px;color:var(--text-primary);width:260px;font-family:inherit;display:block;margin:0 auto 12px}
    .password-form input:focus{outline:none;border-color:var(--accent-coffee)}
    .password-form button{background:var(--accent-coffee);color:#fff;border:none;border-radius:var(--radius-sm);padding:10px 28px;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;transition:opacity .15s}
    .password-form button:hover{opacity:.85}
    .password-error{color:var(--accent-red);font-size:12px;margin-top:12px;display:none}

    /* ‚ïê‚ïê‚ïê Shell ‚ïê‚ïê‚ïê */
    .shell{display:none;min-height:100vh}

    /* ‚ïê‚ïê‚ïê Top Bar ‚ïê‚ïê‚ïê */
    .topbar{
      position:sticky;top:0;z-index:100;
      background:rgba(9,9,11,0.8);
      backdrop-filter:blur(12px);
      border-bottom:1px solid var(--border);
      padding:0 32px;
      height:56px;
      display:flex;align-items:center;justify-content:space-between;
    }
    .topbar-left{display:flex;align-items:center;gap:16px}
    .topbar-logo{font-size:20px}
    .topbar-title{font-size:15px;font-weight:600;letter-spacing:-0.3px}
    .topbar-title span{color:var(--accent-coffee);font-weight:700}
    .topbar-right{display:flex;align-items:center;gap:20px}
    .topbar-clock{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--text-muted);letter-spacing:0.5px}
    .gateway-status{display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px}
    .gateway-dot{width:7px;height:7px;border-radius:50%;background:var(--accent-green);animation:pulse 2s infinite}

    /* ‚ïê‚ïê‚ïê Navigation Tabs ‚ïê‚ïê‚ïê */
    .nav-tabs{
      display:flex;gap:0;
      border-bottom:1px solid var(--border);
      padding:0 32px;
      background:var(--bg-primary);
    }
    .nav-tab{
      padding:12px 20px;font-size:13px;font-weight:500;color:var(--text-muted);
      cursor:pointer;border-bottom:2px solid transparent;transition:all .15s;
      user-select:none;
    }
    .nav-tab:hover{color:var(--text-secondary)}
    .nav-tab.active{color:var(--text-primary);border-bottom-color:var(--accent-coffee)}

    /* ‚ïê‚ïê‚ïê Layout ‚ïê‚ïê‚ïê */
    .main{padding:24px 32px 48px;max-width:1440px;margin:0 auto}
    .page{display:none}
    .page.active{display:block}

    /* ‚ïê‚ïê‚ïê Grid System ‚ïê‚ïê‚ïê */
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    .grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px}
    .grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:20px}
    .span-2{grid-column:span 2}
    .span-3{grid-column:span 3}

    /* ‚ïê‚ïê‚ïê Section Headers ‚ïê‚ïê‚ïê */
    .section-header{
      display:flex;align-items:center;justify-content:space-between;
      margin-bottom:16px;
    }
    .section-title{
      font-size:13px;font-weight:600;text-transform:uppercase;
      letter-spacing:1px;color:var(--text-muted);
      display:flex;align-items:center;gap:8px;
    }
    .section-count{
      background:var(--bg-elevated);border-radius:10px;
      padding:2px 8px;font-size:11px;font-weight:600;
      color:var(--text-secondary);
    }

    /* ‚ïê‚ïê‚ïê Cards ‚ïê‚ïê‚ïê */
    .card{
      background:var(--bg-card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:20px;
      transition:all .15s;
    }
    .card:hover{border-color:var(--border-hover);background:var(--bg-card-hover)}
    .card-sm{padding:16px}

    /* ‚ïê‚ïê‚ïê Summary Stats ‚ïê‚ïê‚ïê */
    .summary-bar{
      display:grid;grid-template-columns:repeat(5,1fr);gap:16px;
      margin-bottom:28px;
    }
    .summary-stat{
      background:var(--bg-card);border:1px solid var(--border);
      border-radius:var(--radius);padding:16px 20px;
    }
    .summary-stat .label{font-size:11px;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-muted);margin-bottom:6px}
    .summary-stat .value{font-size:24px;font-weight:700;letter-spacing:-0.5px}
    .summary-stat .sub{font-size:11px;color:var(--text-muted);margin-top:2px}

    /* ‚ïê‚ïê‚ïê Energy Bar ‚ïê‚ïê‚ïê */
    .energy-card{padding:14px 16px}
    .energy-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .energy-title{font-size:11px;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-muted)}
    .energy-updated{font-size:10px;color:var(--text-muted);font-family:'JetBrains Mono',monospace}
    .energy-row{margin-top:8px}
    .energy-meta{display:flex;justify-content:space-between;font-size:11px;color:var(--text-secondary);margin-bottom:4px}
    .energy-track{height:8px;border-radius:999px;background:var(--bg-elevated);overflow:hidden;border:1px solid var(--border)}
    .energy-fill{height:100%;transition:width .3s ease}
    .energy-fill.window{background:linear-gradient(90deg,var(--accent-blue),#34d399)}
    .energy-fill.day{background:linear-gradient(90deg,var(--accent-purple),#60a5fa)}

    /* ‚ïê‚ïê‚ïê Agent Cards ‚ïê‚ïê‚ïê */
    .agent-card{position:relative;overflow:hidden}
    .agent-card .accent-bar{position:absolute;top:0;left:0;right:0;height:2px}
    .agent-card.role-cos .accent-bar{background:var(--accent-blue)}
    .agent-card.role-sales .accent-bar{background:var(--accent-green)}
    .agent-card.role-cto .accent-bar{background:var(--accent-yellow)}
    .agent-card.role-life .accent-bar{background:var(--accent-red)}

    .agent-header{display:flex;align-items:center;gap:14px;margin-bottom:16px}
    .agent-avatar{
      width:44px;height:44px;border-radius:10px;
      display:flex;align-items:center;justify-content:center;
      font-size:22px;flex-shrink:0;
    }
    .role-cos .agent-avatar{background:var(--accent-blue-bg)}
    .role-sales .agent-avatar{background:var(--accent-green-bg)}
    .role-cto .agent-avatar{background:var(--accent-yellow-bg)}
    .role-life .agent-avatar{background:var(--accent-red-bg)}

    .agent-info{flex:1;min-width:0}
    .agent-name{font-size:15px;font-weight:600;letter-spacing:-0.2px}
    .agent-role{font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px}

    .agent-status{
      display:flex;align-items:center;gap:5px;
      font-size:11px;color:var(--text-muted);
      text-transform:uppercase;letter-spacing:0.5px;
    }
    .status-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
    .status-dot.online{background:var(--accent-green);animation:pulse 2s infinite}
    .status-dot.standby{background:var(--accent-yellow)}
    .status-dot.offline{background:var(--text-muted)}

    .agent-body{border-top:1px solid var(--border);padding-top:14px}
    .agent-field{margin-bottom:12px}
    .agent-field:last-child{margin-bottom:0}
    .agent-field .label{font-size:10px;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-muted);margin-bottom:4px}
    .agent-field .value{font-size:13px;color:var(--text-secondary);line-height:1.5}

    .agent-meta{
      display:flex;gap:12px;margin-top:14px;padding-top:12px;
      border-top:1px solid var(--border);
    }
    .meta-item{
      flex:1;background:rgba(0,0,0,0.3);border-radius:var(--radius-xs);
      padding:8px 10px;text-align:center;
    }
    .meta-item .num{font-size:18px;font-weight:700}
    .meta-item .lbl{font-size:9px;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-muted);margin-top:2px}

    /* ‚ïê‚ïê‚ïê Org Chart ‚ïê‚ïê‚ïê */
    .org-chart{display:flex;flex-direction:column;align-items:center;gap:0;padding:24px 0}
    .org-level{display:flex;flex-direction:column;align-items:center;position:relative}
    .org-connector{width:2px;height:28px;background:var(--border)}
    .org-branch{display:flex;align-items:flex-start;gap:20px;position:relative}
    .org-branch::before{
      content:'';position:absolute;top:0;
      left:calc(50% - 180px);right:calc(50% - 180px);
      height:2px;background:var(--border);
    }
    .org-node{
      background:var(--bg-card);border:1px solid var(--border);
      border-radius:var(--radius);padding:14px 20px;text-align:center;
      min-width:160px;position:relative;
    }
    .org-node::before{
      content:'';position:absolute;top:-14px;left:50%;
      width:2px;height:14px;background:var(--border);
    }
    .org-node .icon{font-size:24px;margin-bottom:6px}
    .org-node .name{font-size:13px;font-weight:600}
    .org-node .title{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px}
    .org-node.primary{border-color:var(--accent-purple);background:var(--accent-purple-bg)}
    .org-node.primary::before{background:var(--accent-purple)}
    .org-node.hub{border-color:var(--accent-blue);background:var(--accent-blue-bg)}
    .org-node.hub::before{display:none}

    /* ‚ïê‚ïê‚ïê Brief ‚ïê‚ïê‚ïê */
    .brief-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:24px}
    .brief-title{font-size:16px;font-weight:600;margin-bottom:20px;display:flex;align-items:center;gap:10px}
    .brief-section{margin-bottom:20px}
    .brief-section:last-child{margin-bottom:0}
    .brief-section h4{font-size:11px;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-muted);margin-bottom:10px}
    .brief-item{
      display:flex;align-items:flex-start;gap:10px;
      padding:10px 14px;background:rgba(0,0,0,0.25);
      border-radius:var(--radius-xs);margin-bottom:6px;
    }
    .brief-item:last-child{margin-bottom:0}
    .brief-tag{
      font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;
      padding:3px 7px;border-radius:4px;white-space:nowrap;flex-shrink:0;margin-top:2px;
    }
    .tag-decision{background:var(--accent-purple-bg);color:var(--accent-purple)}
    .tag-action{background:var(--accent-blue-bg);color:var(--accent-blue)}
    .tag-review{background:var(--accent-yellow-bg);color:var(--accent-yellow)}
    .tag-alert{background:var(--accent-red-bg);color:var(--accent-red)}
    .tag-info{background:var(--accent-green-bg);color:var(--accent-green)}
    .brief-text{font-size:13px;color:var(--text-secondary);line-height:1.6}

    /* ‚ïê‚ïê‚ïê Activity Feed ‚ïê‚ïê‚ïê */
    .feed-list{display:flex;flex-direction:column;gap:0}
    .feed-item{
      display:flex;gap:14px;padding:14px 0;
      border-bottom:1px solid var(--border);
    }
    .feed-item:last-child{border-bottom:none}
    .feed-dot{
      width:8px;height:8px;border-radius:50%;flex-shrink:0;margin-top:5px;
    }
    .feed-dot.agent{background:var(--accent-blue)}
    .feed-dot.system{background:var(--accent-purple)}
    .feed-dot.user{background:var(--accent-green)}
    .feed-dot.alert{background:var(--accent-red)}
    .feed-content{flex:1;min-width:0}
    .feed-action{font-size:13px;color:var(--text-secondary);line-height:1.5}
    .feed-action strong{color:var(--text-primary);font-weight:600}
    .feed-time{font-size:11px;color:var(--text-muted);margin-top:2px;font-family:'JetBrains Mono',monospace}

    /* ‚ïê‚ïê‚ïê Task List ‚ïê‚ïê‚ïê */
    .task-list{display:flex;flex-direction:column;gap:6px}
    .task-item{
      display:flex;align-items:center;gap:12px;
      padding:10px 14px;background:rgba(0,0,0,0.2);
      border-radius:var(--radius-xs);
    }
    .task-check{
      width:18px;height:18px;border-radius:4px;
      border:2px solid var(--border);flex-shrink:0;
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;transition:all .15s;font-size:10px;
    }
    .task-check.done{background:var(--accent-green);border-color:var(--accent-green);color:#fff}
    .task-text{font-size:13px;color:var(--text-secondary);flex:1}
    .task-text.done{text-decoration:line-through;color:var(--text-muted)}
    .task-assignee{
      font-size:10px;background:var(--bg-elevated);
      padding:2px 8px;border-radius:10px;color:var(--text-muted);
      white-space:nowrap;
    }
    .task-priority{
      width:6px;height:6px;border-radius:50%;flex-shrink:0;
    }
    .task-priority.high{background:var(--accent-red)}
    .task-priority.medium{background:var(--accent-yellow)}
    .task-priority.low{background:var(--accent-green)}

    /* ‚ïê‚ïê‚ïê Pipeline Table ‚ïê‚ïê‚ïê */
    .pipeline-table{width:100%;font-size:13px}
    .pipeline-table th{
      text-align:left;font-size:10px;text-transform:uppercase;
      letter-spacing:0.8px;color:var(--text-muted);padding:8px 12px;
      border-bottom:1px solid var(--border);font-weight:600;
    }
    .pipeline-table td{
      padding:10px 12px;border-bottom:1px solid var(--border);
      color:var(--text-secondary);
    }
    .pipeline-table tr:last-child td{border-bottom:none}
    .pipeline-status{
      font-size:10px;font-weight:600;text-transform:uppercase;
      padding:3px 8px;border-radius:10px;
    }
    .pipeline-status.active{background:var(--accent-green-bg);color:var(--accent-green)}
    .pipeline-status.cold{background:var(--accent-yellow-bg);color:var(--accent-yellow)}
    .pipeline-status.new{background:var(--accent-blue-bg);color:var(--accent-blue)}

    /* ‚ïê‚ïê‚ïê System Health ‚ïê‚ïê‚ïê */
    .health-grid{display:flex;flex-direction:column;gap:8px}
    .health-row{
      display:flex;align-items:center;gap:12px;
      padding:10px 14px;background:rgba(0,0,0,0.2);
      border-radius:var(--radius-xs);
    }
    .health-indicator{width:8px;height:8px;border-radius:50%;flex-shrink:0}
    .health-indicator.green{background:var(--accent-green)}
    .health-indicator.yellow{background:var(--accent-yellow)}
    .health-indicator.red{background:var(--accent-red)}
    .health-name{font-size:13px;flex:1;color:var(--text-secondary)}
    .health-value{font-size:11px;color:var(--text-muted);font-family:'JetBrains Mono',monospace}

    /* ‚ïê‚ïê‚ïê Footer ‚ïê‚ïê‚ïê */
    .footer{
      text-align:center;padding:32px;
      color:var(--text-muted);font-size:11px;
      border-top:1px solid var(--border);
      margin-top:48px;
    }
    .footer a{color:var(--accent-coffee);text-decoration:none}

    /* ‚ïê‚ïê‚ïê Animations ‚ïê‚ïê‚ïê */
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    .fade-in{animation:fadeIn .3s ease-out}

    /* ‚ïê‚ïê‚ïê Responsive ‚ïê‚ïê‚ïê */
    @media(max-width:1024px){
      .grid-4{grid-template-columns:repeat(2,1fr)}
      .grid-3{grid-template-columns:1fr 1fr}
      .summary-bar{grid-template-columns:repeat(3,1fr)}
      .span-3{grid-column:span 2}
    }
    @media(max-width:768px){
      .topbar,.nav-tabs,.main{padding-left:16px;padding-right:16px}
      .grid-4,.grid-3,.grid-2{grid-template-columns:1fr}
      .summary-bar{grid-template-columns:repeat(2,1fr)}
      .span-2,.span-3{grid-column:span 1}
      .org-branch{flex-direction:column;align-items:center}
      .org-branch::before{display:none}
    }

    /* ‚ïê‚ïê‚ïê Scrollbar ‚ïê‚ïê‚ïê */
    ::-webkit-scrollbar{width:6px}
    ::-webkit-scrollbar-track{background:transparent}
    ::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
    ::-webkit-scrollbar-thumb:hover{background:var(--border-hover)}
  </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê Password Gate ‚ïê‚ïê‚ïê -->
<div class="password-gate" id="passwordGate">
  <div class="password-form">
    <div class="logo">üéØ</div>
    <h1>Mission Control</h1>
    <p>Freedom & Coffee Executive System</p>
    <input type="password" id="passwordInput" placeholder="Password" autofocus>
    <button id="enterBtn" type="button">Enter</button>
    <p class="password-error" id="passwordError">Incorrect password</p>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê Main Shell ‚ïê‚ïê‚ïê -->
<div class="shell" id="shell">

  <!-- Top Bar -->
  <div class="topbar">
    <div class="topbar-left">
      <span class="topbar-logo">üéØ</span>
      <span class="topbar-title"><span>Mission Control</span> ‚Äî Freedom & Coffee</span>
    </div>
    <div class="topbar-right">
      <div class="gateway-status">
        <span class="gateway-dot"></span>
        Gateway Online
      </div>
      <div class="topbar-clock" id="clock"></div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="nav-tabs">
    <div class="nav-tab active" data-page="overview">Overview</div>
    <div class="nav-tab" data-page="agents">Agents</div>
    <div class="nav-tab" data-page="brief">Daily Brief</div>
    <div class="nav-tab" data-page="pipeline">Pipeline</div>
    <div class="nav-tab" data-page="tasks">Tasks</div>
    <div class="nav-tab" data-page="org">Org Chart</div>
  </div>

  <div class="main">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê OVERVIEW PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page active" id="page-overview">

      <!-- Summary Stats -->
      <div class="summary-bar fade-in">
        <div class="summary-stat">
          <div class="label">Agents Online</div>
          <div class="value" style="color:var(--accent-green)">6</div>
          <div class="sub">of 6 deployed</div>
        </div>
        <div class="summary-stat">
          <div class="label">Tasks in Queue</div>
          <div class="value" id="statQueue">7</div>
          <div class="sub">3 high priority</div>
        </div>
        <div class="summary-stat">
          <div class="label">Decisions Pending</div>
          <div class="value" style="color:var(--accent-purple)">3</div>
          <div class="sub">for Dom</div>
        </div>
        <div class="summary-stat">
          <div class="label">Pipeline</div>
          <div class="value" style="color:var(--accent-green)">4</div>
          <div class="sub">active leads</div>
        </div>
        <div class="summary-stat">
          <div class="label">System Health</div>
          <div class="value" style="color:var(--accent-green)">100%</div>
          <div class="sub">all systems go</div>
        </div>
      </div>

      <div class="card energy-card fade-in" style="margin-bottom:20px">
        <div class="energy-head">
          <div class="energy-title">‚ö° Usage Energy</div>
          <div style="display:flex;align-items:center;gap:10px">
            <button id="energyRefreshBtn" style="background:var(--bg-elevated);border:1px solid var(--border);color:var(--text-secondary);font-size:10px;padding:4px 8px;border-radius:999px;cursor:pointer">‚Üª Refresh</button>
            <div class="energy-updated" id="energyUpdated">live</div>
          </div>
        </div>
        <div class="energy-row">
          <div class="energy-meta">
            <span>5h Pro Window: <strong id="energyWindowPct">--%</strong></span>
            <span>Reset in <span id="energyWindowReset">--:--:--</span></span>
          </div>
          <div class="energy-track"><div class="energy-fill window" id="energyWindowBar" style="width:0%"></div></div>
        </div>
        <div class="energy-row">
          <div class="energy-meta">
            <span>Weekly Window: <strong id="energyDayPct">--%</strong></span>
            <span>Reset in <span id="energyDayReset">--:--:--</span></span>
          </div>
          <div class="energy-track"><div class="energy-fill day" id="energyDayBar" style="width:0%"></div></div>
        </div>
        <div style="margin-top:8px;font-size:11px;color:var(--text-muted)">
          Plan: <strong>ChatGPT Pro</strong> ¬∑ Multi-session headroom enabled
        </div>
      </div>

      <div class="card fade-in" style="margin-bottom:20px">
        <div class="section-header" style="margin-bottom:12px">
          <div class="section-title">üß≠ COO Intake Router (Conrad)</div>
        </div>
        <div style="display:flex;gap:10px;align-items:flex-start;flex-wrap:wrap">
          <textarea id="cooIntakeInput" placeholder="Add a task by text or voice. Example: 'Follow up with Living Leadership today and prep a confidence script.'" style="flex:1;min-height:88px;background:var(--bg-elevated);border:1px solid var(--border);border-radius:10px;padding:10px;color:var(--text-primary);font-size:13px;resize:vertical"></textarea>
          <div style="display:flex;flex-direction:column;gap:8px;min-width:190px">
            <select id="cooRouteOverride" style="background:var(--bg-elevated);border:1px solid var(--border);color:var(--text-primary);padding:10px;border-radius:8px">
              <option value="auto">Auto-route (recommended)</option>
              <option value="Conrad">Conrad ¬∑ Chief of Staff</option>
              <option value="Martin">Martin ¬∑ Chief Hustle Officer</option>
              <option value="Vale">Vale ¬∑ Chief Mindset Officer</option>
              <option value="Tech Agent">Tech Agent ¬∑ CTO</option>
              <option value="Life Agent">Life Agent ¬∑ Chief Life Officer</option>
            </select>
            <button id="cooVoiceBtn" style="background:rgba(96,165,250,.18);border:1px solid rgba(96,165,250,.3);color:#dbeafe;padding:10px;border-radius:8px;cursor:pointer">üéôÔ∏è Voice Input</button>
            <button id="cooRouteBtn" style="background:rgba(34,197,94,.18);border:1px solid rgba(34,197,94,.35);color:#dcfce7;padding:10px;border-radius:8px;cursor:pointer">Route Task</button>
          </div>
        </div>
        <div id="cooRouteHint" style="margin-top:8px;font-size:12px;color:var(--text-muted)">Suggested route: Conrad (auto)</div>
        <div id="cooRouteStatus" style="margin-top:6px;font-size:12px;color:var(--text-muted)">Ready.</div>
        <div id="cooRouteLog" style="margin-top:10px;display:flex;flex-direction:column;gap:8px"></div>
      </div>

      <div class="grid-3">
        <!-- Agent Status Cards (compact) -->
        <div class="span-2">
          <div class="section-header">
            <div class="section-title">Agent Status <span class="section-count">6</span></div>
          </div>
          <div class="grid-2">
            <!-- Conrad -->
            <div class="card card-sm agent-card role-cos">
              <div class="accent-bar"></div>
              <div class="agent-header">
                <div class="agent-avatar">üé≠</div>
                <div class="agent-info">
                  <div class="agent-name">Conrad</div>
                  <div class="agent-role">Chief of Staff</div>
                </div>
                <div class="agent-status"><span class="status-dot online"></span>Active</div>
              </div>
              <div class="agent-body">
                <div class="agent-field">
                  <div class="label">Current Task</div>
                  <div class="value" id="ovCosFocus">Building Mission Control dashboard</div>
                </div>
                <div class="agent-meta">
                  <div class="meta-item"><div class="num" id="ovCosQueue">5</div><div class="lbl">Queue</div></div>
                  <div class="meta-item"><div class="num">12</div><div class="lbl">Today</div></div>
                  <div class="meta-item"><div class="num">GPT 5.3</div><div class="lbl">Model</div></div>
                </div>
              </div>
            </div>
            <!-- Sales -->
            <div class="card card-sm agent-card role-sales">
              <div class="accent-bar"></div>
              <div class="agent-header">
                <div class="agent-avatar">üíº</div>
                <div class="agent-info">
                  <div class="agent-name">Sales Agent</div>
                  <div class="agent-role">Head of Sales</div>
                </div>
                <div class="agent-status"><span class="status-dot standby"></span>Standby</div>
              </div>
              <div class="agent-body">
                <div class="agent-field">
                  <div class="label">Pipeline</div>
                  <div class="value">4 active leads ¬∑ 2 awaiting follow-up</div>
                </div>
                <div class="agent-meta">
                  <div class="meta-item"><div class="num">4</div><div class="lbl">Leads</div></div>
                  <div class="meta-item"><div class="num">~$20K</div><div class="lbl">Pipeline</div></div>
                  <div class="meta-item"><div class="num">GPT 5.3</div><div class="lbl">Model</div></div>
                </div>
              </div>
            </div>
            <!-- CTO -->
            <div class="card card-sm agent-card role-cto">
              <div class="accent-bar"></div>
              <div class="agent-header">
                <div class="agent-avatar">‚öôÔ∏è</div>
                <div class="agent-info">
                  <div class="agent-name">Tech Agent</div>
                  <div class="agent-role">CTO</div>
                </div>
                <div class="agent-status"><span class="status-dot online"></span>Monitoring</div>
              </div>
              <div class="agent-body">
                <div class="agent-field">
                  <div class="label">System Status</div>
                  <div class="value">All systems operational</div>
                </div>
                <div class="agent-meta">
                  <div class="meta-item"><div class="num">0</div><div class="lbl">Alerts</div></div>
                  <div class="meta-item"><div class="num">99.9%</div><div class="lbl">Uptime</div></div>
                  <div class="meta-item"><div class="num">GPT 5.3</div><div class="lbl">Model</div></div>
                </div>
              </div>
            </div>
            <!-- Life -->
            <div class="card card-sm agent-card role-life">
              <div class="accent-bar"></div>
              <div class="agent-header">
                <div class="agent-avatar">üßò</div>
                <div class="agent-info">
                  <div class="agent-name">Life Agent</div>
                  <div class="agent-role">Chief Life Officer</div>
                </div>
                <div class="agent-status"><span class="status-dot standby"></span>Observing</div>
              </div>
              <div class="agent-body">
                <div class="agent-field">
                  <div class="label">Life Balance</div>
                  <div class="value">Last workout: 2 days ago ¬∑ Family time: moderate</div>
                </div>
                <div class="agent-meta">
                  <div class="meta-item"><div class="num">3</div><div class="lbl">Workouts/Wk</div></div>
                  <div class="meta-item"><div class="num">7.2</div><div class="lbl">Balance</div></div>
                  <div class="meta-item"><div class="num">GPT 5.3</div><div class="lbl">Model</div></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Martin -->
          <div class="card card-sm agent-card role-sales">
            <div class="accent-bar"></div>
            <div class="agent-header">
              <div class="agent-avatar">üöÄ</div>
              <div class="agent-info">
                <div class="agent-name">Martin</div>
                <div class="agent-role">Chief Hustle Officer</div>
              </div>
              <div class="agent-status"><span class="status-dot standby"></span>Queued</div>
            </div>
            <div class="agent-body">
              <div class="agent-field">
                <div class="label">Current Focus</div>
                <div class="value">Outbound momentum, fast follow-ups, and pipeline pressure.</div>
              </div>
              <div class="agent-meta">
                <div class="meta-item"><div class="num">18</div><div class="lbl">Tasks</div></div>
                <div class="meta-item"><div class="num">High</div><div class="lbl">Tempo</div></div>
                <div class="meta-item"><div class="num">GPT 5.3</div><div class="lbl">Model</div></div>
              </div>
            </div>
          </div>

          <!-- Vale -->
          <div class="card card-sm agent-card role-life">
            <div class="accent-bar"></div>
            <div class="agent-header">
              <div class="agent-avatar">üß†</div>
              <div class="agent-info">
                <div class="agent-name">Vale</div>
                <div class="agent-role">Chief Mindset Officer</div>
              </div>
              <div class="agent-status"><span class="status-dot standby"></span>Listening</div>
            </div>
            <div class="agent-body">
              <div class="agent-field">
                <div class="label">Current Focus</div>
                <div class="value">Cognitive framing, stress calibration, and decision clarity.</div>
              </div>
              <div class="agent-meta">
                <div class="meta-item"><div class="num">7</div><div class="lbl">Check-ins</div></div>
                <div class="meta-item"><div class="num">Calm</div><div class="lbl">Mode</div></div>
                <div class="meta-item"><div class="num">GPT 5.3</div><div class="lbl">Model</div></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Activity Feed -->
        <div>
          <div class="section-header">
            <div class="section-title">Activity Feed</div>
          </div>
          <div class="card" style="max-height:520px;overflow-y:auto">
            <div class="feed-list" id="feedList">
              <div class="feed-item">
                <div class="feed-dot agent"></div>
                <div class="feed-content">
                  <div class="feed-action"><strong>Conrad</strong> started building Mission Control v2</div>
                  <div class="feed-time">23:47 PST</div>
                </div>
              </div>
              <div class="feed-item">
                <div class="feed-dot system"></div>
                <div class="feed-content">
                  <div class="feed-action"><strong>System</strong> deployed Mission Control to GitHub Pages</div>
                  <div class="feed-time">22:30 PST</div>
                </div>
              </div>
              <div class="feed-item">
                <div class="feed-dot user"></div>
                <div class="feed-content">
                  <div class="feed-action"><strong>Dom</strong> approved PRD for multi-agent system</div>
                  <div class="feed-time">22:15 PST</div>
                </div>
              </div>
              <div class="feed-item">
                <div class="feed-dot agent"></div>
                <div class="feed-content">
                  <div class="feed-action"><strong>Conrad</strong> drafted role state files for all 4 agents</div>
                  <div class="feed-time">21:45 PST</div>
                </div>
              </div>
              <div class="feed-item">
                <div class="feed-dot agent"></div>
                <div class="feed-content">
                  <div class="feed-action"><strong>CTO Agent</strong> completed infrastructure health check</div>
                  <div class="feed-time">21:30 PST</div>
                </div>
              </div>
              <div class="feed-item">
                <div class="feed-dot system"></div>
                <div class="feed-content">
                  <div class="feed-action"><strong>System</strong> Supabase migration drafted (pending run)</div>
                  <div class="feed-time">21:00 PST</div>
                </div>
              </div>
              <div class="feed-item">
                <div class="feed-dot user"></div>
                <div class="feed-content">
                  <div class="feed-action"><strong>Dom</strong> chose standalone build over Notion MVP</div>
                  <div class="feed-time">20:30 PST</div>
                </div>
              </div>
              <div class="feed-item">
                <div class="feed-dot agent"></div>
                <div class="feed-content">
                  <div class="feed-action"><strong>Sales Agent</strong> flagged Living Leadership ‚Äî 3 days cold</div>
                  <div class="feed-time">19:00 PST</div>
                </div>
              </div>
              <div class="feed-item">
                <div class="feed-dot alert"></div>
                <div class="feed-content">
                  <div class="feed-action"><strong>Life Agent</strong> reminder: Dom hasn't eaten enough today</div>
                  <div class="feed-time">18:00 PST</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Priority Queue -->
      <div style="margin-top:24px">
        <div class="section-header">
          <div class="section-title">Priority Queue <span class="section-count">7</span></div>
        </div>
        <div class="card">
          <div class="task-list">
            <div class="task-item">
              <div class="task-priority high"></div>
              <div class="task-check">‚¨ú</div>
              <div class="task-text">Run Supabase migration for roles tables</div>
              <div class="task-assignee">CTO</div>
            </div>
            <div class="task-item">
              <div class="task-priority high"></div>
              <div class="task-check">‚¨ú</div>
              <div class="task-text">Deploy Mission Control to GitHub Pages</div>
              <div class="task-assignee">Conrad</div>
            </div>
            <div class="task-item">
              <div class="task-priority high"></div>
              <div class="task-check">‚¨ú</div>
              <div class="task-text">Follow up with Living Leadership (3 days cold)</div>
              <div class="task-assignee">Sales</div>
            </div>
            <div class="task-item">
              <div class="task-priority medium"></div>
              <div class="task-check">‚¨ú</div>
              <div class="task-text">Create cron job for morning brief (8am)</div>
              <div class="task-assignee">Conrad</div>
            </div>
            <div class="task-item">
              <div class="task-priority medium"></div>
              <div class="task-check">‚¨ú</div>
              <div class="task-text">Set up role session spawning</div>
              <div class="task-assignee">Conrad</div>
            </div>
            <div class="task-item">
              <div class="task-priority medium"></div>
              <div class="task-check">‚¨ú</div>
              <div class="task-text">Purchase 2-3 email domains for SDR warm-up</div>
              <div class="task-assignee">Sales</div>
            </div>
            <div class="task-item">
              <div class="task-priority low"></div>
              <div class="task-check">‚¨ú</div>
              <div class="task-text">NakamaOS DB connection handling review</div>
              <div class="task-assignee">CTO</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AGENTS PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-agents">
      <div class="section-header">
        <div class="section-title">Agent Details <span class="section-count">6</span></div>
      </div>

      <!-- Dom Card -->
      <div class="card" style="margin-bottom:20px;border-color:var(--accent-purple);background:var(--accent-purple-bg)">
        <div class="agent-header">
          <div class="agent-avatar" style="background:var(--accent-purple-bg);font-size:24px">üë§</div>
          <div class="agent-info">
            <div class="agent-name">Dominique DeLeon</div>
            <div class="agent-role">CEO / Founder</div>
          </div>
          <div class="agent-status"><span class="status-dot online"></span>Online</div>
        </div>
        <div class="agent-body">
          <div class="agent-field">
            <div class="label">Current Focus</div>
            <div class="value">Building multi-agent executive system ¬∑ Preparing for Spain/Portugal exit June 2026</div>
          </div>
          <div class="agent-meta">
            <div class="meta-item"><div class="num">3</div><div class="lbl">Decisions</div></div>
            <div class="meta-item"><div class="num">4.5h</div><div class="lbl">Flow Time</div></div>
            <div class="meta-item"><div class="num">10+</div><div class="lbl">Workstreams</div></div>
            <div class="meta-item"><div class="num">1-2h</div><div class="lbl">Daily Target</div></div>
          </div>
        </div>
      </div>

      <div class="grid-2">
        <!-- Conrad Full -->
        <div class="card agent-card role-cos">
          <div class="accent-bar"></div>
          <div class="agent-header">
            <div class="agent-avatar">üé≠</div>
            <div class="agent-info">
              <div class="agent-name">Conrad</div>
              <div class="agent-role">Chief of Staff</div>
            </div>
            <div class="agent-status"><span class="status-dot online"></span>Active</div>
          </div>
          <div class="agent-body">
            <div class="agent-field">
              <div class="label">Function</div>
              <div class="value">Hub/orchestrator. Daily brief, priority queue, calendar protection, email triage. Routes to other roles.</div>
            </div>
            <div class="agent-field">
              <div class="label">Autonomy Level</div>
              <div class="value">Recommend (evolving to autonomous)</div>
            </div>
            <div class="agent-field">
              <div class="label">Current Task</div>
              <div class="value" id="agCosFocus">Building Mission Control dashboard</div>
            </div>
            <div class="agent-field">
              <div class="label">Queue</div>
              <div class="value">Run Supabase migration ¬∑ Deploy to GitHub Pages ¬∑ Create morning brief cron ¬∑ Set up role sessions</div>
            </div>
            <div class="agent-field">
              <div class="label">Recent Decisions</div>
              <div class="value">Chose standalone build over Notion ¬∑ Org chart visual confirmed ¬∑ Hub architecture (no peer-to-peer)</div>
            </div>
            <div class="agent-meta">
              <div class="meta-item"><div class="num">GPT 5.3</div><div class="lbl">Model</div></div>
              <div class="meta-item"><div class="num">5</div><div class="lbl">Queue</div></div>
              <div class="meta-item"><div class="num">12</div><div class="lbl">Completed</div></div>
            </div>
          </div>
        </div>
        <!-- Sales Full -->
        <div class="card agent-card role-sales">
          <div class="accent-bar"></div>
          <div class="agent-header">
            <div class="agent-avatar">üíº</div>
            <div class="agent-info">
              <div class="agent-name">Sales Agent</div>
              <div class="agent-role">Head of Sales</div>
            </div>
            <div class="agent-status"><span class="status-dot standby"></span>Standby</div>
          </div>
          <div class="agent-body">
            <div class="agent-field">
              <div class="label">Function</div>
              <div class="value">Lead follow-up, pipeline management, outreach sequences, client research.</div>
            </div>
            <div class="agent-field">
              <div class="label">Autonomy Level</div>
              <div class="value">Recommend ‚Üí Autonomous (outreach)</div>
            </div>
            <div class="agent-field">
              <div class="label">SDR Build Status</div>
              <div class="value">‚ö†Ô∏è Blocked ‚Äî Need 2-3 email domains purchased + 2-week warm-up. May pilot Yess AI ($99/mo) in parallel.</div>
            </div>
            <div class="agent-field">
              <div class="label">Key Focus</div>
              <div class="value">Consistent $10K+ months</div>
            </div>
            <div class="agent-meta">
              <div class="meta-item"><div class="num">GPT 5.3</div><div class="lbl">Model</div></div>
              <div class="meta-item"><div class="num">4</div><div class="lbl">Leads</div></div>
              <div class="meta-item"><div class="num">~$20K</div><div class="lbl">Pipeline</div></div>
            </div>
          </div>
        </div>
        <!-- CTO Full -->
        <div class="card agent-card role-cto">
          <div class="accent-bar"></div>
          <div class="agent-header">
            <div class="agent-avatar">‚öôÔ∏è</div>
            <div class="agent-info">
              <div class="agent-name">Tech Agent</div>
              <div class="agent-role">CTO</div>
            </div>
            <div class="agent-status"><span class="status-dot online"></span>Monitoring</div>
          </div>
          <div class="agent-body">
            <div class="agent-field">
              <div class="label">Function</div>
              <div class="value">Code security, bug monitoring, infrastructure health, proactive fixes.</div>
            </div>
            <div class="agent-field">
              <div class="label">Autonomy Level</div>
              <div class="value">Autonomous (monitoring), Recommend (changes)</div>
            </div>
            <div class="agent-field">
              <div class="label">Tech Debt</div>
              <div class="value">NakamaOS DB review ¬∑ Automated security scanning ¬∑ Uptime monitoring setup</div>
            </div>
            <div class="agent-meta">
              <div class="meta-item"><div class="num">GPT 5.3</div><div class="lbl">Model</div></div>
              <div class="meta-item"><div class="num">0</div><div class="lbl">Alerts</div></div>
              <div class="meta-item"><div class="num">99.9%</div><div class="lbl">Uptime</div></div>
            </div>
          </div>
        </div>
        <!-- Life Full -->
        <div class="card agent-card role-life">
          <div class="accent-bar"></div>
          <div class="agent-header">
            <div class="agent-avatar">üßò</div>
            <div class="agent-info">
              <div class="agent-name">Life Agent</div>
              <div class="agent-role">Chief Life Officer</div>
            </div>
            <div class="agent-status"><span class="status-dot standby"></span>Observing</div>
          </div>
          <div class="agent-body">
            <div class="agent-field">
              <div class="label">Function</div>
              <div class="value">Long-game tracking: relationships, health, family, faith, legacy alignment.</div>
            </div>
            <div class="agent-field">
              <div class="label">Autonomy Level</div>
              <div class="value">Alert only ‚Äî weekly check-in (Mondays), quarterly deep review</div>
            </div>
            <div class="agent-field">
              <div class="label">Life Goals</div>
              <div class="value">üá™üá∏ US Exit June 2026 ¬∑ ü•ä First amateur fight May 2026 ¬∑ üí∞ F&C to $10K+/mo consistent</div>
            </div>
            <div class="agent-field">
              <div class="label">Upcoming</div>
              <div class="value">Asa 2-month checkup this week ¬∑ Danai work event Thursday</div>
            </div>
            <div class="agent-meta">
              <div class="meta-item"><div class="num">GPT 5.3</div><div class="lbl">Model</div></div>
              <div class="meta-item"><div class="num">3/wk</div><div class="lbl">Workouts</div></div>
              <div class="meta-item"><div class="num">7.2</div><div class="lbl">Balance</div></div>
            </div>
          </div>
        </div>

        <!-- Martin Full -->
        <div class="card agent-card role-sales">
          <div class="accent-bar"></div>
          <div class="agent-header">
            <div class="agent-avatar">üöÄ</div>
            <div class="agent-info">
              <div class="agent-name">Martin</div>
              <div class="agent-role">Chief Hustle Officer</div>
            </div>
            <div class="agent-status"><span class="status-dot standby"></span>Queued</div>
          </div>
          <div class="agent-body">
            <div class="agent-field"><div class="label">Function</div><div class="value">Drive outbound velocity, follow-up rigor, and revenue motion consistency.</div></div>
            <div class="agent-field"><div class="label">Autonomy Level</div><div class="value">Autonomous (task execution), Recommend (offer changes)</div></div>
            <div class="agent-field"><div class="label">Current Task</div><div class="value">Pending role playbook</div></div>
            <div class="agent-meta">
              <div class="meta-item"><div class="num">GPT 5.3</div><div class="lbl">Model</div></div>
              <div class="meta-item"><div class="num">0</div><div class="lbl">Assigned</div></div>
              <div class="meta-item"><div class="num">Fast</div><div class="lbl">Pace</div></div>
            </div>
          </div>
        </div>

        <!-- Vale Full -->
        <div class="card agent-card role-life">
          <div class="accent-bar"></div>
          <div class="agent-header">
            <div class="agent-avatar">üß†</div>
            <div class="agent-info">
              <div class="agent-name">Vale</div>
              <div class="agent-role">Chief Mindset Officer</div>
            </div>
            <div class="agent-status"><span class="status-dot standby"></span>Listening</div>
          </div>
          <div class="agent-body">
            <div class="agent-field"><div class="label">Function</div><div class="value">Mental framing, confidence systems, and decision hygiene under pressure.</div></div>
            <div class="agent-field"><div class="label">Autonomy Level</div><div class="value">Advisory + check-in trigger mode</div></div>
            <div class="agent-field"><div class="label">Current Task</div><div class="value">Pending role playbook</div></div>
            <div class="agent-meta">
              <div class="meta-item"><div class="num">GPT 5.3</div><div class="lbl">Model</div></div>
              <div class="meta-item"><div class="num">0</div><div class="lbl">Assigned</div></div>
              <div class="meta-item"><div class="num">Calm</div><div class="lbl">Mode</div></div>
            </div>
          </div>
        </div>
      </div>

      <!-- System Health -->
      <div style="margin-top:24px">
        <div class="section-header">
          <div class="section-title">System Health</div>
        </div>
        <div class="card">
          <div class="health-grid">
            <div class="health-row">
              <div class="health-indicator green"></div>
              <div class="health-name">Supabase Database</div>
              <div class="health-value">Healthy ¬∑ Last check 2026-02-17</div>
            </div>
            <div class="health-row">
              <div class="health-indicator green"></div>
              <div class="health-name">Mission Control Dashboard</div>
              <div class="health-value">Building v2 ¬∑ Overnight deploy</div>
            </div>
            <div class="health-row">
              <div class="health-indicator yellow"></div>
              <div class="health-name">NakamaOS</div>
              <div class="health-value">‚è∏Ô∏è Needs DB review ¬∑ Queued</div>
            </div>
            <div class="health-row">
              <div class="health-indicator green"></div>
              <div class="health-name">OpenClaw Gateway</div>
              <div class="health-value">Running ¬∑ Port 18789</div>
            </div>
            <div class="health-row">
              <div class="health-indicator green"></div>
              <div class="health-name">Supabase Project</div>
              <div class="health-value">sgcynfmkhqowdboweahz ¬∑ Online</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DAILY BRIEF PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-brief">
      <div class="brief-card fade-in">
        <div class="brief-title">üìã Daily Brief ‚Äî <span id="briefDate"></span></div>

        <div class="brief-section">
          <h4>üéØ Today's Priorities</h4>
          <div class="brief-item">
            <span class="brief-tag tag-decision">Decision</span>
            <span class="brief-text">Multi-agent system architecture ‚Äî PRD approved, begin build phase</span>
          </div>
          <div class="brief-item">
            <span class="brief-tag tag-action">Action</span>
            <span class="brief-text">AI SDR build blocked on email domain purchase ‚Äî 2-week warm-up needed. Consider piloting Yess AI ($99/mo) in parallel.</span>
          </div>
          <div class="brief-item">
            <span class="brief-tag tag-review">Review</span>
            <span class="brief-text">Living Leadership follow-up overdue (3 days cold). Sales Agent recommends re-engagement today.</span>
          </div>
          <div class="brief-item">
            <span class="brief-tag tag-alert">Alert</span>
            <span class="brief-text">Egami re: Mielle deliverable timeline ‚Äî flagged as URGENT in email triage</span>
          </div>
        </div>

        <div class="brief-section">
          <h4>üì¨ Email Triage</h4>
          <div class="brief-item">
            <span class="brief-tag tag-alert">Urgent</span>
            <span class="brief-text">Egami re: Mielle deliverable timeline</span>
          </div>
          <div class="brief-item">
            <span class="brief-tag tag-info">Can Wait</span>
            <span class="brief-text">Theme Health feedback</span>
          </div>
        </div>

        <div class="brief-section">
          <h4>üìÖ Calendar</h4>
          <div class="brief-item">
            <span class="brief-text">Protected deep work block available. No external meetings scheduled today. ‚úì</span>
          </div>
        </div>

        <div class="brief-section">
          <h4>üí∞ Sales Pipeline</h4>
          <div class="brief-item">
            <span class="brief-text">
              <strong>Active leads:</strong> 4 &nbsp;¬∑&nbsp; <strong>Awaiting response:</strong> 2 &nbsp;¬∑&nbsp; <strong>Projected this month:</strong> ~$20K<br>
              <strong>‚ö†Ô∏è Follow-up due:</strong> Living Leadership (3 days cold), Theme Health (awaiting feedback)
            </span>
          </div>
        </div>

        <div class="brief-section">
          <h4>üîß Tech Status</h4>
          <div class="brief-item">
            <span class="brief-tag tag-info">Green</span>
            <span class="brief-text">All systems operational. All systems operational. No security alerts.</span>
          </div>
        </div>

        <div class="brief-section">
          <h4>üßò Life Check</h4>
          <div class="brief-item">
            <span class="brief-text">
              Last workout: 2 days ago &nbsp;¬∑&nbsp; Target: 294 ‚Üí 260 lbs<br>
              Upcoming: Asa 2-month checkup this week? &nbsp;¬∑&nbsp; Danai work event Thursday<br>
              <em style="color:var(--text-muted)">"Is this week's work moving toward the life you actually want?"</em>
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PIPELINE PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-pipeline">
      <div class="section-header">
        <div class="section-title">Sales Pipeline <span class="section-count">4 leads</span></div>
      </div>
      <div class="card">
        <table class="pipeline-table">
          <thead>
            <tr>
              <th>Client</th>
              <th>Status</th>
              <th>Next Action</th>
              <th>Last Contact</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Living Leadership</strong></td>
              <td><span class="pipeline-status cold">3 Days Cold</span></td>
              <td>Re-engagement follow-up</td>
              <td style="font-family:'JetBrains Mono',monospace;font-size:12px">Feb 14</td>
              <td>TBD</td>
            </tr>
            <tr>
              <td><strong>Theme Health</strong></td>
              <td><span class="pipeline-status active">Active</span></td>
              <td>Awaiting feedback</td>
              <td style="font-family:'JetBrains Mono',monospace;font-size:12px">Feb 16</td>
              <td>TBD</td>
            </tr>
            <tr>
              <td><strong>The Refig</strong></td>
              <td><span class="pipeline-status active">Active</span></td>
              <td>Proposal sent ‚Äî follow up</td>
              <td style="font-family:'JetBrains Mono',monospace;font-size:12px">Feb 15</td>
              <td>TBD</td>
            </tr>
            <tr>
              <td><strong>P&G/Mielle (via Egami)</strong></td>
              <td><span class="pipeline-status active">Active</span></td>
              <td>Deliverable in progress</td>
              <td style="font-family:'JetBrains Mono',monospace;font-size:12px">Feb 17</td>
              <td>TBD</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div style="margin-top:24px">
        <div class="section-header">
          <div class="section-title">SDR Build Status</div>
        </div>
        <div class="card">
          <div class="brief-item" style="background:var(--accent-yellow-bg);border:1px solid rgba(251,191,36,0.15)">
            <span class="brief-tag tag-alert">Blocked</span>
            <span class="brief-text">
              <strong>AI SDR Pipeline:</strong> Architecture drafted but blocked on infrastructure.<br>
              <strong>Needs:</strong> 2-3 email domains purchased + 2-week warm-up period<br>
              <strong>Alternative:</strong> Pilot Yess AI ($99/mo) while warming up domains<br>
              <strong>Goal:</strong> Consistent $10K+ monthly revenue
            </span>
          </div>
        </div>
      </div>

      <div style="margin-top:24px">
        <div class="section-header">
          <div class="section-title">Revenue Metrics</div>
        </div>
        <div class="grid-3">
          <div class="summary-stat">
            <div class="label">This Month (Projected)</div>
            <div class="value" style="color:var(--accent-green)">~$20K</div>
          </div>
          <div class="summary-stat">
            <div class="label">Active Leads</div>
            <div class="value">4</div>
          </div>
          <div class="summary-stat">
            <div class="label">Monthly Target</div>
            <div class="value" style="color:var(--accent-coffee)">$10K+</div>
            <div class="sub">consistent</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TASKS PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-tasks">
      <div class="section-header">
        <div class="section-title">Task Board <span class="section-count" id="taskCount">0</span></div>
      </div>

      <div class="grid-3" id="taskColumns">
        <!-- Backlog -->
        <div>
          <div style="font-size:12px;font-weight:600;color:var(--accent-yellow);margin-bottom:12px;text-transform:uppercase;letter-spacing:0.8px">üìã Backlog</div>
          <div id="taskBacklog" style="display:flex;flex-direction:column;gap:10px"></div>
        </div>
        <!-- In Progress -->
        <div>
          <div style="font-size:12px;font-weight:600;color:var(--accent-blue);margin-bottom:12px;text-transform:uppercase;letter-spacing:0.8px">üîß In Progress</div>
          <div id="taskInProgress" style="display:flex;flex-direction:column;gap:10px"></div>
        </div>
        <!-- Done -->
        <div>
          <div style="font-size:12px;font-weight:600;color:var(--accent-green);margin-bottom:12px;text-transform:uppercase;letter-spacing:0.8px">‚úÖ Done</div>
          <div id="taskDone" style="display:flex;flex-direction:column;gap:10px"></div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ORG CHART PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-org">
      <div class="section-header">
        <div class="section-title">Organization Structure</div>
      </div>
      <div class="card" style="padding:40px 20px">
        <div class="org-chart">
          <!-- CEO -->
          <div class="org-level">
            <div class="org-node primary" style="border-color:var(--accent-purple)">
              <div class="icon">üë§</div>
              <div class="name">Dominique DeLeon</div>
              <div class="title">CEO / Founder</div>
            </div>
          </div>
          <div class="org-connector"></div>
          <!-- CoS -->
          <div class="org-level">
            <div class="org-node hub">
              <div class="icon">üé≠</div>
              <div class="name">Conrad</div>
              <div class="title">Chief of Staff ¬∑ Hub</div>
            </div>
          </div>
          <div class="org-connector"></div>
          <!-- Specialist Row -->
          <div class="org-level">
            <div class="org-branch">
              <div class="org-node">
                <div class="icon">üíº</div>
                <div class="name">Sales Agent</div>
                <div class="title">Head of Sales</div>
              </div>
              <div class="org-node">
                <div class="icon">‚öôÔ∏è</div>
                <div class="name">Tech Agent</div>
                <div class="title">CTO</div>
              </div>
              <div class="org-node">
                <div class="icon">üßò</div>
                <div class="name">Life Agent</div>
                <div class="title">Chief Life Officer</div>
              </div>
              <div class="org-node">
                <div class="icon">üöÄ</div>
                <div class="name">Martin</div>
                <div class="title">Chief Hustle Officer</div>
              </div>
              <div class="org-node">
                <div class="icon">üß†</div>
                <div class="name">Vale</div>
                <div class="title">Chief Mindset Officer</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Phase 2 Preview -->
        <div style="margin-top:40px;padding-top:24px;border-top:1px solid var(--border)">
          <div class="section-header">
            <div class="section-title">Phase 2 Roles (Planned)</div>
          </div>
          <div class="grid-4" style="margin-top:8px">
            <div style="text-align:center;padding:12px;background:rgba(0,0,0,0.2);border-radius:var(--radius-xs);opacity:0.5">
              <div style="font-size:20px;margin-bottom:4px">üì¶</div>
              <div style="font-size:12px;font-weight:600">CPO</div>
              <div style="font-size:10px;color:var(--text-muted)">Product</div>
            </div>
            <div style="text-align:center;padding:12px;background:rgba(0,0,0,0.2);border-radius:var(--radius-xs);opacity:0.5">
              <div style="font-size:20px;margin-bottom:4px">üî¨</div>
              <div style="font-size:12px;font-weight:600">CRO</div>
              <div style="font-size:10px;color:var(--text-muted)">Research</div>
            </div>
            <div style="text-align:center;padding:12px;background:rgba(0,0,0,0.2);border-radius:var(--radius-xs);opacity:0.5">
              <div style="font-size:20px;margin-bottom:4px">üìà</div>
              <div style="font-size:12px;font-weight:600">CGO</div>
              <div style="font-size:10px;color:var(--text-muted)">Growth</div>
            </div>
            <div style="text-align:center;padding:12px;background:rgba(0,0,0,0.2);border-radius:var(--radius-xs);opacity:0.5">
              <div style="font-size:20px;margin-bottom:4px">üíµ</div>
              <div style="font-size:12px;font-weight:600">CFO</div>
              <div style="font-size:10px;color:var(--text-muted)">Finance</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Control Plane (inspired by openclaw-mission-control) -->
      <div style="margin-top:24px">
        <div class="section-header">
          <div class="section-title">Control Plane Quick Actions</div>
        </div>
        <div class="card">
          <div class="grid-3">
            <div>
              <div style="font-size:12px;font-weight:600;color:var(--accent-green);margin-bottom:8px">Approvals</div>
              <button onclick="window.open('https://docs.openclaw.ai/cli/approvals','_blank')" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--bg-elevated);color:var(--text-primary);cursor:pointer">Open approvals docs</button>
            </div>
            <div>
              <div style="font-size:12px;font-weight:600;color:var(--accent-blue);margin-bottom:8px">Gateway Status</div>
              <button onclick="window.open('https://docs.openclaw.ai/cli/gateway','_blank')" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--bg-elevated);color:var(--text-primary);cursor:pointer">Gateway controls</button>
            </div>
            <div>
              <div style="font-size:12px;font-weight:600;color:var(--accent-purple);margin-bottom:8px">Audit Trail</div>
              <button onclick="window.open('https://docs.openclaw.ai/cli/cron','_blank')" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--bg-elevated);color:var(--text-primary);cursor:pointer">Cron + run history</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Communication Protocol -->
      <div style="margin-top:24px">
        <div class="section-header">
          <div class="section-title">Communication Protocol</div>
        </div>
        <div class="card">
          <div class="grid-3">
            <div>
              <div style="font-size:12px;font-weight:600;color:var(--accent-blue);margin-bottom:8px">Dom ‚Üí Role</div>
              <div style="font-size:13px;color:var(--text-secondary);line-height:1.6">Message parsed by Chief of Staff, routed to appropriate role session.</div>
            </div>
            <div>
              <div style="font-size:12px;font-weight:600;color:var(--accent-green);margin-bottom:8px">Role ‚Üí Dom</div>
              <div style="font-size:13px;color:var(--text-secondary);line-height:1.6">Surfaced through Chief of Staff in daily brief or real-time alerts (if urgent).</div>
            </div>
            <div>
              <div style="font-size:12px;font-weight:600;color:var(--accent-purple);margin-bottom:8px">Role ‚Üí Role</div>
              <div style="font-size:13px;color:var(--text-secondary);line-height:1.6">Written handoffs via shared memory files. No synchronous agent-to-agent calls.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /main -->

  <div class="footer">
    Mission Control v3.0 ¬∑ Freedom & Coffee ¬∑ Built by Conrad üé≠<br>
    <a href="https://github.com/ddeleon82/mission-control" target="_blank">GitHub</a>
  </div>

</div><!-- /shell -->

<!-- Password auth - standalone, no dependencies -->
<script>
  (function() {
    var pw = document.getElementById('passwordInput');
    var btn = document.getElementById('enterBtn');
    var gate = document.getElementById('passwordGate');
    var shell = document.getElementById('shell');
    var err = document.getElementById('passwordError');

    function doLogin() {
      var val = pw.value;
      if (val === 'freedomandcoffee') {
        gate.style.display = 'none';
        shell.style.display = 'block';
        try { localStorage.setItem('mc_auth', 'true'); } catch(e) {}
        if (typeof initDashboard === 'function') initDashboard();
      } else {
        err.style.display = 'block';
        pw.value = '';
      }
    }

    btn.addEventListener('click', doLogin);
    btn.addEventListener('touchend', function(e) { e.preventDefault(); doLogin(); });
    pw.addEventListener('keyup', function(e) { if (e.key === 'Enter') doLogin(); });

    try {
      if (localStorage.getItem('mc_auth') === 'true') {
        gate.style.display = 'none';
        shell.style.display = 'block';
      }
    } catch(e) {}
  })();
</script>

<script>
  // ‚ïê‚ïê‚ïê Config ‚ïê‚ïê‚ïê
  const SUPABASE_URL = 'https://sgcynfmkhqowdboweahz.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNnY3luZm1raHFvd2Rib3dlYWh6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3Nzg0OTYsImV4cCI6MjA4NDM1NDQ5Nn0.adsPZ0U_Ce2oM7MWaczBN9sqjVGhFfaht01eBktD6As';
  const PASSWORD_HASH = 'f4127ad448fa57d63edf47ee143f43a56b6357d7d81f76260e9f05e301643ecb';

  let supabase;
  try {
    supabase = window.supabase ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY) : null;
  } catch(e) { console.warn('Supabase init failed:', e); }

  // Auth handled in standalone script above

  // ‚ïê‚ïê‚ïê Navigation ‚ïê‚ïê‚ïê
  function switchPage(page) {
    if (!page) return;
    const target = document.getElementById('page-' + page);
    if (!target) return;
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    const tab = document.querySelector(`.nav-tab[data-page="${page}"]`);
    if (tab) tab.classList.add('active');
    target.classList.add('active');
    try { history.replaceState(null, '', '#' + page); } catch(e) {}
  }

  document.querySelectorAll('.nav-tab').forEach(tab => {
    tab.addEventListener('click', () => switchPage(tab.dataset.page));
  });

  // Load from hash on refresh
  if (location.hash) switchPage(location.hash.replace('#',''));

  // ‚ïê‚ïê‚ïê Dashboard Init ‚ïê‚ïê‚ïê
  function initDashboard() {
    updateClock();
    setInterval(updateClock, 1000);
    setBriefDate();
    initEnergyBar();
    initCOORouter();
    loadSupabaseData();
  }

  // ‚ïê‚ïê‚ïê Usage Energy Bar ‚ïê‚ïê‚ïê
  // Starts with snapshot fallback; attempts live sync from local OpenClaw status endpoint.
  const ENERGY_STATE = {
    windowPct: 100,
    windowResetAt: Date.now() + (5 * 60 * 60 * 1000), // Pro fallback window
    dayPct: 100,
    dayResetAt: Date.now() + (7 * 24 * 60 * 60 * 1000), // Pro fallback weekly window
    source: 'snapshot',
    lastSyncAt: null
  };

  function initEnergyBar() {
    renderEnergyBar();
    // Refresh countdown continuously.
    setInterval(renderEnergyBar, 1000);
    // Try initial live sync immediately, then every 60s.
    syncEnergyFromOpenClaw();
    setInterval(syncEnergyFromOpenClaw, 60000);

    const btn = document.getElementById('energyRefreshBtn');
    if (btn) {
      btn.addEventListener('click', async () => {
        btn.disabled = true;
        btn.textContent = '‚Ä¶';
        await syncEnergyFromOpenClaw(true);
        btn.textContent = '‚Üª Refresh';
        btn.disabled = false;
      });
    }
  }

  function formatCountdown(ms) {
    if (ms <= 0) return '00:00:00';
    const total = Math.floor(ms / 1000);
    const d = Math.floor(total / 86400);
    const h = Math.floor((total % 86400) / 3600);
    const m = Math.floor((total % 3600) / 60);
    const s = total % 60;
    if (d > 0) return `${d}d ${String(h).padStart(2,'0')}h`;
    return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }

  function renderEnergyBar() {
    const now = Date.now();
    const windowMsLeft = ENERGY_STATE.windowResetAt - now;
    const dayMsLeft = ENERGY_STATE.dayResetAt - now;

    const windowPctEl = document.getElementById('energyWindowPct');
    const dayPctEl = document.getElementById('energyDayPct');
    const windowResetEl = document.getElementById('energyWindowReset');
    const dayResetEl = document.getElementById('energyDayReset');
    const windowBar = document.getElementById('energyWindowBar');
    const dayBar = document.getElementById('energyDayBar');
    const updated = document.getElementById('energyUpdated');

    if (windowPctEl) windowPctEl.textContent = `${ENERGY_STATE.windowPct}%`;
    if (dayPctEl) dayPctEl.textContent = `${ENERGY_STATE.dayPct}%`;
    if (windowResetEl) windowResetEl.textContent = formatCountdown(windowMsLeft);
    if (dayResetEl) dayResetEl.textContent = formatCountdown(dayMsLeft);
    if (windowBar) windowBar.style.width = `${Math.max(0, Math.min(100, ENERGY_STATE.windowPct))}%`;
    if (dayBar) dayBar.style.width = `${Math.max(0, Math.min(100, ENERGY_STATE.dayPct))}%`;
    if (updated) {
      const t = new Date().toLocaleTimeString('en-US', { hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false });
      const source = ENERGY_STATE.source || 'snapshot';
      updated.textContent = `${source} ${t}`;
    }

    // Reset cycle handling
    if (windowMsLeft <= 0) {
      ENERGY_STATE.windowPct = 100;
      ENERGY_STATE.windowResetAt = now + (5 * 60 * 60 * 1000);
    }
    if (dayMsLeft <= 0) {
      ENERGY_STATE.dayPct = 100;
      ENERGY_STATE.dayResetAt = now + (7 * 24 * 60 * 60 * 1000);
    }
  }

  function parseDurationToMs(text) {
    if (!text || typeof text !== 'string') return null;
    let total = 0;
    const day = text.match(/(\d+)d/);
    const hr = text.match(/(\d+)h/);
    const min = text.match(/(\d+)m/);
    const sec = text.match(/(\d+)s/);
    if (day) total += Number(day[1]) * 86400;
    if (hr) total += Number(hr[1]) * 3600;
    if (min) total += Number(min[1]) * 60;
    if (sec) total += Number(sec[1]);
    return total > 0 ? total * 1000 : null;
  }

  function extractEnergyFromStatusText(text) {
    if (!text || typeof text !== 'string') return null;
    const fiveHour = text.match(/5h\s+(\d+)%\s+left\s+‚è±([^¬∑\n]+)/);
    const day = text.match(/Day\s+(\d+)%\s+left\s+‚è±([^\n]+)/);
    if (!fiveHour || !day) return null;

    const fiveHourPct = Number(fiveHour[1]);
    const dayPct = Number(day[1]);
    const fiveHourMs = parseDurationToMs(fiveHour[2].trim());
    const dayMs = parseDurationToMs(day[2].trim());
    if (!Number.isFinite(fiveHourPct) || !Number.isFinite(dayPct) || !fiveHourMs || !dayMs) return null;

    return {
      windowPct: fiveHourPct,
      dayPct,
      windowResetAt: Date.now() + fiveHourMs,
      dayResetAt: Date.now() + dayMs
    };
  }

  function extractEnergyFromUsageRow(text) {
    // Format: USAGE|window_pct=91|window_left=2h39m|day_pct=97|day_left=6d21h
    if (!text || typeof text !== 'string' || !text.startsWith('USAGE|')) return null;
    const wp = text.match(/window_pct=(\d+)/);
    const wl = text.match(/window_left=([^|]+)/);
    const dp = text.match(/day_pct=(\d+)/);
    const dl = text.match(/day_left=([^|]+)/);
    if (!wp || !wl || !dp || !dl) return null;
    const windowPct = Number(wp[1]);
    const dayPct = Number(dp[1]);
    const windowMs = parseDurationToMs(wl[1]);
    const dayMs = parseDurationToMs(dl[1]);
    if (!Number.isFinite(windowPct) || !Number.isFinite(dayPct) || !windowMs || !dayMs) return null;
    return {
      windowPct,
      dayPct,
      windowResetAt: Date.now() + windowMs,
      dayResetAt: Date.now() + dayMs
    };
  }

  async function syncEnergyFromOpenClaw(manual = false) {
    // Preferred path: Supabase usage row (works on GitHub Pages, no local CORS issues)
    if (supabase) {
      try {
        const { data, error } = await supabase
          .from('agent_status')
          .select('current_task,last_heartbeat')
          .eq('id', 'usage')
          .order('last_heartbeat', { ascending: false })
          .limit(1);

        if (!error && data && data.length) {
          const parsed = extractEnergyFromUsageRow(data[0]?.current_task || '');
          if (parsed) {
            ENERGY_STATE.windowPct = parsed.windowPct;
            ENERGY_STATE.dayPct = parsed.dayPct;
            ENERGY_STATE.windowResetAt = parsed.windowResetAt;
            ENERGY_STATE.dayResetAt = parsed.dayResetAt;
            ENERGY_STATE.source = 'supabase';
            ENERGY_STATE.lastSyncAt = Date.now();
            renderEnergyBar();
            return;
          }
        }
      } catch (e) {
        // fall through
      }
    }

    // Fallback: local gateway status endpoints (works when opened from same machine + allowed CORS)
    const candidates = [
      'http://127.0.0.1:18789/status',
      '/status'
    ];

    for (const url of candidates) {
      try {
        const res = await fetch(url, { method: 'GET' });
        if (!res.ok) continue;
        const text = await res.text();
        const parsed = extractEnergyFromStatusText(text);
        if (!parsed) continue;

        ENERGY_STATE.windowPct = parsed.windowPct;
        ENERGY_STATE.dayPct = parsed.dayPct;
        ENERGY_STATE.windowResetAt = parsed.windowResetAt;
        ENERGY_STATE.dayResetAt = parsed.dayResetAt;
        ENERGY_STATE.source = 'live';
        ENERGY_STATE.lastSyncAt = Date.now();
        renderEnergyBar();
        return;
      } catch (e) {
        // Keep trying candidates; fallback snapshot remains.
      }
    }

    ENERGY_STATE.source = 'snapshot';
  }

  const ROUTE_MAP = {
    'Conrad': { role: 'Chief of Staff', priority: 'medium' },
    'Martin': { role: 'Chief Hustle Officer', priority: 'high' },
    'Vale': { role: 'Chief Mindset Officer', priority: 'medium' },
    'Tech Agent': { role: 'CTO', priority: 'high' },
    'Life Agent': { role: 'Chief Life Officer', priority: 'low' }
  };

  function initCOORouter() {
    const input = document.getElementById('cooIntakeInput');
    const routeBtn = document.getElementById('cooRouteBtn');
    const voiceBtn = document.getElementById('cooVoiceBtn');
    const override = document.getElementById('cooRouteOverride');
    const status = document.getElementById('cooRouteStatus');

    const refreshHint = () => {
      const text = (input?.value || '').trim();
      const hint = document.getElementById('cooRouteHint');
      if (!hint) return;
      if (!text) { hint.textContent = 'Suggested route: Conrad (auto)'; return; }
      const suggested = inferRoute(text);
      const forced = override?.value || 'auto';
      if (forced !== 'auto') {
        hint.textContent = `Forced route: ${forced} (override active)`;
      } else {
        hint.textContent = `Suggested route: ${suggested.assignee} (${suggested.role})`;
      }
    };

    if (input && !input.dataset.bound) {
      input.dataset.bound = '1';
      input.addEventListener('input', refreshHint);
    }
    if (override && !override.dataset.bound) {
      override.dataset.bound = '1';
      override.addEventListener('change', refreshHint);
    }

    if (routeBtn && !routeBtn.dataset.bound) {
      routeBtn.dataset.bound = '1';
      routeBtn.addEventListener('click', async () => {
        const text = (input?.value || '').trim();
        if (!text) {
          if (status) status.textContent = 'Add a task first.';
          return;
        }
        await routeCOOTask(text, override?.value || 'auto');
        if (input) input.value = '';
        if (override) override.value = 'auto';
        refreshHint();
      });
    }

    if (voiceBtn && !voiceBtn.dataset.bound) {
      voiceBtn.dataset.bound = '1';
      voiceBtn.addEventListener('click', () => {
        const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SR) {
          if (status) status.textContent = 'Voice input not supported in this browser.';
          return;
        }
        const recog = new SR();
        recog.lang = 'en-US';
        recog.interimResults = false;
        recog.maxAlternatives = 1;
        if (status) status.textContent = 'Listening‚Ä¶';
        recog.onresult = (ev) => {
          const transcript = ev.results?.[0]?.[0]?.transcript || '';
          if (input) input.value = transcript;
          refreshHint();
          if (status) status.textContent = 'Voice captured. Review route, then click Route Task.';
        };
        recog.onerror = () => { if (status) status.textContent = 'Voice capture failed.'; };
        recog.start();
      });
    }

    refreshHint();
  }

  function inferRoute(text) {
    const t = text.toLowerCase();
    const scores = { 'Conrad': 0, 'Martin': 0, 'Vale': 0, 'Tech Agent': 0, 'Life Agent': 0 };

    if (/(ad build|ad set|creative|campaign|lead|outreach|follow up|sales|close|prospect|pipeline|offer|client)/.test(t)) scores['Martin'] += 3;
    if (/(mindset|confidence|stress|energy|clarity|focus|mental|burnout|overwhelm|motivation)/.test(t)) scores['Vale'] += 3;
    if (/(code|bug|dashboard|supabase|n8n|api|deploy|automation|build|script|repo|github)/.test(t)) scores['Tech Agent'] += 3;
    if (/(calendar|brief|organize|plan|ops|route|coo|admin|prioritize|schedule|email cleanup|inbox)/.test(t)) scores['Conrad'] += 3;
    if (/(health|workout|family|sleep|nutrition|recovery|boxing)/.test(t)) scores['Life Agent'] += 2;

    // default bias to COO for ambiguous tasks
    scores['Conrad'] += 1;

    const assignee = Object.entries(scores).sort((a,b) => b[1]-a[1])[0][0];
    const routeMeta = ROUTE_MAP[assignee] || ROUTE_MAP['Conrad'];
    return { assignee, role: routeMeta.role, priority: routeMeta.priority };
  }

  async function routeCOOTask(text, forcedAssignee = 'auto') {
    const status = document.getElementById('cooRouteStatus');
    const log = document.getElementById('cooRouteLog');
    const suggested = inferRoute(text);

    // Conrad-first orchestration model: all inbound tasks are assigned to Conrad.
    const route = {
      assignee: 'Conrad',
      role: 'Chief of Staff',
      priority: suggested.priority,
      suggestedAssignee: (forcedAssignee !== 'auto' && ROUTE_MAP[forcedAssignee]) ? forcedAssignee : suggested.assignee
    };

    if (status) status.textContent = `Routing to Conrad‚Ä¶`;

    const descriptionWithHint = `[Suggested delegate: ${route.suggestedAssignee}] ${text}`;

    let persisted = false;
    let errorHint = '';
    if (supabase) {
      try {
        const payload = {
          title: text.slice(0, 110),
          description: descriptionWithHint,
          status: 'backlog',
          priority: route.priority,
          assigned_to: route.assignee
        };
        const { error } = await supabase.from('tasks').insert(payload);
        if (!error) persisted = true;
        else errorHint = error.message || 'insert failed';
      } catch (e) {
        errorHint = e?.message || 'network failure';
      }
    }

    if (log) {
      const item = document.createElement('div');
      item.className = 'card card-sm';
      item.innerHTML = `<div style="font-size:12px"><strong>Routed:</strong> Conrad <span style="color:var(--text-muted)">(Chief of Staff)</span></div><div style="font-size:11px;color:var(--text-muted);margin-top:2px">Suggested delegate: ${route.suggestedAssignee}</div><div style="font-size:12px;color:var(--text-secondary);margin-top:4px">${text}</div>`;
      log.prepend(item);
      while (log.children.length > 6) log.removeChild(log.lastChild);
    }

    if (!persisted) {
      try {
        const existing = JSON.parse(localStorage.getItem('mc_local_tasks') || '[]');
        existing.unshift({
          id: `local-${Date.now()}`,
          title: text.slice(0, 110),
          description: descriptionWithHint,
          status: 'backlog',
          priority: route.priority,
          assigned_to: route.assignee,
          created_at: new Date().toISOString()
        });
        localStorage.setItem('mc_local_tasks', JSON.stringify(existing.slice(0, 100)));
      } catch(e) {}
    }

    if (status) status.textContent = persisted
      ? `‚úÖ Sent to Conrad. Suggested delegate: ${route.suggestedAssignee}.`
      : `‚ö†Ô∏è Sent to Conrad (saved locally). Suggested delegate: ${route.suggestedAssignee}. Supabase write failed${errorHint ? `: ${errorHint}` : ''}`;

    if (typeof loadTasks === 'function') loadTasks();
  }

  function updateClock() {
    const now = new Date();
    const opts = { hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false, timeZoneName:'short' };
    document.getElementById('clock').textContent = now.toLocaleTimeString('en-US', opts);
  }

  function setBriefDate() {
    const now = new Date();
    const opts = { weekday:'long', year:'numeric', month:'long', day:'numeric' };
    const el = document.getElementById('briefDate');
    if (el) el.textContent = now.toLocaleDateString('en-US', opts);
  }

  // ‚ïê‚ïê‚ïê Supabase Data ‚ïê‚ïê‚ïê
  async function loadSupabaseData() {
    if (!supabase) return;
    try {
      const { data: status } = await supabase
        .from('agent_status')
        .select('*')
        .order('last_heartbeat', { ascending: false })
        .limit(1);

      if (status && status[0]) {
        const s = status[0];
        const task = s.current_task || 'Awaiting instructions';
        ['ovCosFocus','agCosFocus'].forEach(id => {
          const el = document.getElementById(id);
          if (el) el.textContent = task;
        });
      }

      const { data: tasks } = await supabase
        .from('tasks')
        .select('*')
        .in('status', ['backlog','in-progress']);

      if (tasks) {
        const el = document.getElementById('ovCosQueue');
        if (el) el.textContent = tasks.length || '5';
        const sq = document.getElementById('statQueue');
        if (sq) sq.textContent = tasks.length || '7';
      }
    } catch(e) { console.log('Supabase:', e); }
  }

  // ‚ïê‚ïê‚ïê Real-time ‚ïê‚ïê‚ïê
  if (supabase) supabase
    .channel('mc-updates')
    .on('postgres_changes', { event:'*', schema:'public', table:'agent_status' }, () => loadSupabaseData())
    .subscribe();

  // ‚ïê‚ïê‚ïê Task Board ‚ïê‚ïê‚ïê
  async function loadTasks() {
    const backlog = document.getElementById('taskBacklog');
    const inProgress = document.getElementById('taskInProgress');
    const done = document.getElementById('taskDone');
    const count = document.getElementById('taskCount');

    let tasks = [];

    if (supabase) {
      try {
        const { data } = await supabase
          .from('tasks')
          .select('*')
          .order('created_at', { ascending: false });
        if (data) tasks = data;
      } catch(e) {
        console.log('Tasks load error:', e);
      }
    }

    // Merge local fallback tasks (for remote sessions where RLS blocks anon inserts)
    try {
      const local = JSON.parse(localStorage.getItem('mc_local_tasks') || '[]');
      if (Array.isArray(local) && local.length) tasks = [...local, ...tasks];
    } catch(e) {}

    try {
      if (!tasks) tasks = [];

      if (backlog) backlog.innerHTML = '';
      if (inProgress) inProgress.innerHTML = '';
      if (done) done.innerHTML = '';
      if (count) count.textContent = tasks.length;

      tasks.forEach(task => {
        const card = document.createElement('div');
        card.className = 'card card-sm';
        card.style.cursor = 'default';

        const priorityColors = {
          'high': 'var(--accent-red)',
          'medium': 'var(--accent-yellow)',
          'low': 'var(--accent-green)',
          'urgent': 'var(--accent-orange)'
        };
        const pColor = priorityColors[task.priority] || 'var(--text-muted)';

        card.innerHTML = `
          <div style="font-size:13px;font-weight:600;margin-bottom:6px;line-height:1.4">${task.title || 'Untitled'}</div>
          ${task.description ? `<div style="font-size:12px;color:var(--text-secondary);margin-bottom:8px;line-height:1.5">${task.description.substring(0, 120)}${task.description.length > 120 ? '‚Ä¶' : ''}</div>` : ''}
          <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
            ${task.priority ? `<span style="font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;color:${pColor};background:rgba(255,255,255,0.05);padding:2px 8px;border-radius:4px">${task.priority}</span>` : ''}
            ${task.assigned_to ? `<span style="font-size:10px;color:var(--text-muted)">‚Üí ${task.assigned_to}</span>` : ''}
          </div>
        `;

        const status = (task.status || 'backlog').toLowerCase();
        if (status === 'in-progress' || status === 'in_progress') {
          if (inProgress) inProgress.appendChild(card);
        } else if (status === 'done' || status === 'completed') {
          if (done) done.appendChild(card);
        } else {
          if (backlog) backlog.appendChild(card);
        }
      });
    } catch(e) { console.log('Tasks load error:', e); }
  }

  // Load tasks on init
  if (supabase) {
    loadTasks();
    supabase
      .channel('mc-tasks')
      .on('postgres_changes', { event:'*', schema:'public', table:'tasks' }, () => loadTasks())
      .subscribe();
  }

  // ‚ïê‚ïê‚ïê Task Toggle + Inline Editing ‚ïê‚ïê‚ïê
  document.addEventListener('click', (e) => {
    const el = e.target.closest('.task-check');
    if (!el) return;
    el.classList.toggle('done');
    el.textContent = el.classList.contains('done') ? '‚úì' : '‚¨ú';
    const text = el.parentElement?.querySelector('.task-text');
    if (text) text.classList.toggle('done');
  });

  // Double-click editable text fields where it makes sense.
  document.addEventListener('dblclick', (e) => {
    const editable = e.target.closest('.task-text, .agent-field .value, .feed-action');
    if (!editable) return;
    editable.setAttribute('contenteditable', 'true');
    editable.focus();
  });

  document.addEventListener('blur', (e) => {
    const editable = e.target;
    if (editable && editable.getAttribute && editable.getAttribute('contenteditable') === 'true') {
      editable.removeAttribute('contenteditable');
    }
  }, true);

  // Run init after all declarations so const state exists.
  try {
    if (localStorage.getItem('mc_auth') === 'true') initDashboard();
  } catch(e) {}
</script>

</body>
</html>
